<div class="container-fluid">
    <!-- Loader -->
    <div *ngIf="isLoading" class="text-center py-1">
      <p><fa-icon [icon]="faSun" class="fa-spin color-primary" animation="shake"></fa-icon> &nbsp; Chargement des données en cours...</p>
    </div>
  
    <div *ngIf="!isLoading && (statistiquesRealtimeData || lastStatistiquesData)" class="content">
      <!-- En-tête -->
      <div class="content-header d-flex align-items-center justify-content-between">
        <h4 class="content-title">
          <fa-icon [icon]="faChart"></fa-icon> &nbsp; 
          <span *ngIf="statistiquesRealtimeData">Statistiques énergétiques en temps réel</span>
          <span *ngIf="lastStatistiquesData">Dernières statistiques énergétiques enregistrées</span>
        </h4>
        
           
            <button class="btn btn-sm btn-alt-primary" *ngIf="controllerRealtimeData">
              <!-- A FAIRE RECUPERER LA DATE VIA LA METHODE STATUS -->
                Le {{ controllerRealtimeData.controller_date | date: 'd MMMM yyyy à HH:mm':'-01:00':'fr' }}
            </button>
            <button class="btn btn-sm btn-alt-primary" *ngIf="lastStatistiquesData">
                Le {{lastStatistiquesData.last_measurement_time | date: 'd MMMM yyyy à HH:mm':'+01:00':'fr' }}
            </button>

            <button class="btn btn-sm btn-alt-primary etatJour" *ngIf="controllerRealtimeData">

                <fa-icon class="ms-auto" *ngIf="controllerRealtimeData.is_day" [icon]="faSun"  data-bs-toggle="tooltip" title="Panneau solaire actif"></fa-icon>
                <fa-icon class="ms-auto" *ngIf="controllerRealtimeData.is_night" [icon]="faMoon"  data-bs-toggle="tooltip" title="Panneau solaire inactif"></fa-icon>
            </button>
      </div>
  
      <!-- Gauges -->
      <div class="row g-4 mt-4">
        <div class="col-12 col-sm-6 col-md-6 col-lg-3" *ngFor="let gauge of gauges">
        <div class="card text-center shadow-sm">
            <div class="card-header">
                {{gauge.label}}
            </div>
            <div class="card-body">
                <ngx-gauge
                [type]="'arch'"
                [thick]="10"
                [size]="140"
                [value]="gauge.value"
                [label]="gauge.unit"
                [foregroundColor]="'#1263BE'"
                [max]="gauge.max"
                cap="round"
                ></ngx-gauge>
            </div>
          
          <!-- <div class="card-footer">
            <a href="#" class="custom-link">
              Voir les dernières 24H
              <fa-icon [icon]="faArrowRight" class="ms-2"></fa-icon>
            </a>
          </div> -->
        </div>
        
        
        </div>
      </div>

      <!-- Informations du serveur du Kammthaar -->
      <div class="row g-4 mt-4" >
        <div class="col-12 col-sm-6 col-md-6 col-lg-6" >
            <!-- Si Kammthaar est connecté -->
            <div class="card">
                <div class="card-header">
                  <h5>Informations du serveur</h5>
                </div>
                <div class="card-body">
                  <table class="table table-hover">
                    <!-- Informations du serveur du Kammthaar s'il est en ligne -->
                    <tbody *ngIf="isServerOnline && systemInfo">
                      <tr>
                        <td class="text-success"><fa-icon [icon]="faCheck"></fa-icon> &nbsp;Le serveur est connecté</td>
                      </tr>
                      <tr>
                        <td>Utilisation du processeur</td>
                        <td class="d-flex justify-content-end">{{ systemInfo.cpu_usage }}%</td>
                      </tr>
                      <tr>
                        <td>Occupation de la mémoire</td>
                        <td class="d-flex justify-content-end">{{ systemInfo.memory_usage }}%</td>
                      </tr>
                      <tr>
                        <td>Utilisation du disque</td>
                        <td class="d-flex justify-content-end">{{ systemInfo.disk_usage }}%</td>
                      </tr>
                      <tr>
                        <td>Température du serveur</td>
                        <td class="d-flex justify-content-end">{{ systemInfo.temperature  | number: '1.0-1'  }}°C</td>
                      </tr>
                      <tr>
                        <td>Consommation estimée</td>
                        <td class="d-flex justify-content-end">{{ consumed_server*100  | number: '1.0-2'  }}Wh</td>
                      </tr>
                    </tbody>
                    <!-- Si Kammthaar est hors ligne -->
                    <tbody *ngIf="!isServerOnline">
                        <tr>
                            <td class="text-warning"><fa-icon [icon]="faWarning"></fa-icon> &nbsp;Le serveur est hors ligne</td>
                        </tr>
                    </tbody>
                  </table>
                </div>
            </div>
            
        </div>
      </div>
    </div>

    <!-- Message en cas d'absence de données -->
    <div *ngIf="!isLoading && !statistiquesRealtimeData && !lastStatistiquesData"  class="text-center">
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <fa-icon [icon]="faWarning"></fa-icon> &nbsp; Aucune donnée disponible
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
        </div>
    </div>
  </div>
    